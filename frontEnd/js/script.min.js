/*! frontend 2021-09-21 */

!function(){let c;var t,o,s,d={url:""};$.ajax({url:"config.json",type:"GET",dataType:"json",success:function(e){c=`${e.SERVER_URL}:${e.SERVER_PORT}`},error:function(e){console.log(e)}}),console.log("script is linked"),console.log(sessionStorage),$("#createListing").hide(),$("#jobPost").hide(),$("#hidden").hide(),$("#createAd").click(function(){$("#createListing").show()}),$("#addPost").click(function(){$("#jobPost").show(),$("#createListing").hide(),event.preventDefault();var e=$("#businessName").val(),t=$("#jobTitle").val(),o=$("#jobDescription").val(),s=sessionStorage.getItem("userID");console.log(s),console.log(e,t,o),""==e||""==t||""==o?alert("Please enter all details"):($.ajax({url:`${c}/addPost`,type:"POST",data:{jobTitle:t,posterName:e,jobDescription:o,username:s},success:function(e){console.log("post added")},error:function(){console.log("error: cannot call api")}}),$.ajax({url:`${c}/allPosts`,type:"GET",dataType:"json",success:function(t){var o;console.log(t);document.getElementById("editPost");for(document.getElementById("jobPost").innerHTML="",o=0;o<t.length;o++){console.log(t[o]);let e=[];if(null!==t[o].comments){var s=t[o].comments;for(x=1;x<s.length;x++)e+=`<li>${s[x]}</li>`}document.getElementById("jobPost").innerHTML+=`
            <div>
              <h2 id="postTitle">${t[o].jobTitle}</h2>
              <h4 id="posterName">${t[o].posterName}</h4>
              <hr>
              <p id="postDetails">${t[o].jobDescription}</p>
            <div>

            <div>
              <button id="editPost" data-edit-id="${t[o]._id}" name="productButton" type="submit" class="btn btn-primary mx-2 edit-button">Edit</button>
              <br>
              <br>
              <button id="deletePost" data-delete-id="${t[o]._id}" name="productButton" type="submit" class="btn btn-primary mx-2 delete-button">Delete</button>

              <span id="titleUpdate">${t[o].jobTitle}</span>
              <span id="detailsUpdate">${t[o].jobDescription}</span>
              <span id="posterName">${t[o].posterName}</span>
              <span id="postUser">${t[o].username}</span>

            </div>

            <p class="commentBox" data-id="${t[o]._id}">
            ${e}
            //comments go here
            </p>
            <br><b>Post comment</b>
            <input type="text" class="form-control" name="comment" placeholder="Leave a comment here" data-id="${t[o]._id}">
            <button type="button" name="button" class="btn btn-primary btn-md mr-3 rounded-pill commented" data-id="${t[o]._id}">Comment</button>
            `}},error:function(){}}))}),window.addEventListener("click",e=>{"Edit"===e.target.innerHTML&&($("#jobTitle-test").val(e.target.parentNode.children[4].innerText),$("#jobDescription-test").val(e.target.parentNode.children[5].innerText),$("#postHide").val(e.target.parentNode.children[6].innerText),$("#userHide").val(e.target.parentNode.children[7].innerText))},!1),$(document).on("click",".edit-button",function(e){e.preventDefault(),console.log("edit clicked"),$("#hidden").show();var t=$(this).attr("data-edit-id");console.log(t);var o=sessionStorage.getItem("userID"),s=$("#jobTitle-test").val(),a=$("#jobDescription-test").val(),r=$("#postHide").val(),e=$("#userHide").val();console.log(a,o),""==a?alert("Please enter post update information"):$.ajax({url:`${c}/updatePost/${t}`,type:"PATCH",data:{jobTitle:s,jobDescription:a,posterName:r,username:e,user_id:o},success:function(e){console.log(e),"401 error: user has no permission to update"==e?alert("401 error: user has no permission to update"):alert("updated"),$("#postTitle").val(""),$("#postDetails").val("")},error:function(){console.log("error:cannot call api")}})}),$(document).on("click",".delete-button",function(e){e.preventDefault();e=$(this).attr("data-delete-id");console.log(e),console.log("delete clicked"),$.ajax({url:`${c}/deletePost/${e}`,type:"DELETE",data:{user_id:sessionStorage.userID},success:function(e){console.log(e),"Post Deleted"==e?alert("Post Deleted"):alert("Enter a valid id")},error:function(){console.log("error: cannot call api")}})}),convertImg=()=>{var e,t;document.querySelector("#userIcon").files&&document.querySelector("#userIcon").files[0]&&(e=new FileReader,t=document.querySelector("#userIcon").files[0],e.readAsDataURL(t),e.addEventListener("load",e=>{d.url=e.target.result,console.log(d.url)}))},document.querySelector("#userIcon")&&document.querySelector("#userIcon").addEventListener("change",convertImg),$("#studentRegSubmit").click(function(){event.preventDefault();var e=$("#sName").val(),t=$("#sUsername").val(),o=$("#sEmail").val(),s=$("#sPassword").val(),a=$("#sCheckPassword").val(),r=d.url,n=$("#studyField").val(),l=$("#educatorName").val(),i=$("#sExtra").val();console.log(e,t,o,s,n,l,i),s!=a?($("#sCheckPassword").val(""),alert("Passwords do not match. Please try again")):""==e||""==t||""==o||""==s||""==a||""==n||""==l?alert("Please enter all student details"):r?1e7<document.querySelector("#userIcon").files[0].size?alert("Uploaded image file size is too large. Please select an image 10mbs or less."):$.ajax({url:`${c}/registerStudent`,type:"POST",data:{name:e,username:t,email:o,password:s,pfpUrl:r,studyField:n,educator:l,extra:i},success:function(e){window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("accType","student"),console.log(sessionStorage),console.log(e),"username taken already. Please try another name"!==e?(alert("You have been registered!"),window.location.href="studentDash.html"):(alert("Username taken already. Please try another name"),$("#sUsername").val(""),$("#sPassword").val(""))},error:function(){alert("Error: Cannot call API")}}):alert("Please upload an icon for the best experience on this website.")}),$("#employerRegSubmit").click(function(){event.preventDefault();var e=$("#eName").val(),t=$("#eUsername").val(),o=$("#eEmail").val(),s=$("#ePassword").val(),a=$("#eCheckPassword").val(),r=d.url,n=$("#jobTitle").val(),l=$("#company-name").val(),i=$("#companyName").val();console.log(e,t,o,s,n,l,i),s!=a?($("#eCheckPassword").val(""),alert("Passwords do not match. Please try again")):""==e||""==t||""==o||""==s||""==a||""==n||""==l?alert("Please enter all employer details"):r?1e7<document.querySelector("#userIcon").files[0].size?alert("Uploaded image file size is too large. Please select an image 10mbs or less."):$.ajax({url:`${c}/registerEmployer`,type:"POST",data:{name:e,username:t,email:o,password:s,pfpUrl:r,workField:n,companyName:l,extra:i},success:function(e){window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("extra",e.extra),sessionStorage.setItem("accType","employer"),console.log(sessionStorage),console.log(e),"username taken already. Please try another name"!==e?(alert("You have been registered!"),window.location.href="employerDash.html"):(console.log("Username taken already. Please try another name"),$("#eUsername").val(""),$("#ePassword").val(""))},error:function(){alert("Error: cannot call API")}}):alert("Please upload an icon for the best experience on this website.")}),document.querySelector("#loginSubmit")&&(document.querySelector("#loginSubmit").addEventListener("click",()=>{event.preventDefault();var e=$("#username").val(),t=$("#password").val();""===e||""===t?alert("Please enter all of your details."):$.ajax({url:`${c}/loginStudent`,type:"POST",data:{username:e,password:t},success:function(e){"User not found. Please register"==e?checkEmployer():"Not authorized"==e?(alert("Please try again with correct details."),$("#username").val(""),$("#password").val("")):(localStorage.clear(),window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("accType","student"),window.location.href="studentDash.html")}})},!1),checkEmployer=()=>{console.log("running employer checker!"),event.preventDefault();var e=$("#username").val(),t=$("#password").val();""===e||""===t?alert("Please enter all of your details."):$.ajax({url:`${c}/loginEmployer`,type:"POST",data:{username:e,password:t},success:function(e){"User not found. Please register"==e?alert("User not found: Please register as a new user or enter the correct details."):"Not authorized"==e?(alert("Please try again with correct details."),$("#username").val(""),$("#password").val("")):(window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("accType","employer"),window.location.href="employerDash.html")}})}),document.querySelector("#logoutSubmit")&&document.querySelector("#logoutSubmit").addEventListener("click",()=>{logOut()},!1),document.querySelector("#logOut")&&document.querySelector("#logOut").addEventListener("click",()=>{logOut()},!1),logOut=()=>{sessionStorage.clear(),window.name="",alert("You have been logged out."),window.location.href="index.html"},$("#updateSTUDENTPROFILE").click(function(){event.preventDefault();var e=sessionStorage.getItem("userID");$("#name").val(),$("#username").val(),$("#user-email").val(),$("#password").val(),$("#r-name").val(),$("#company-name").val(),$("#r-extra").val();console.log(name,studyField,educator,extra,e),""==name||""==studyField||""==educator||""==extra?alert("Please enter profile update information"):$.ajax({url:`${c}/updateStudent/:id`,type:"PATCH",data:{name:name,studyField:studyField,educator:educator,extra:extra,username_id:e},success:function(e){console.log(e),"401 error: user has no permission to update"==e?alert("401 error: user has no permission to update"):alert("updated"),$("#inputidUpdate").val(""),$("#inputidUpdate").val(""),$("#inputidUpdate").val(""),$("#inputidUpdate").val("")},error:function(){console.log("error:cannot call api")}})}),document.querySelector("#userProfile")&&("student"==sessionStorage.accType?window.addEventListener("load",()=>{$.ajax({url:`${c}/getStudent/${sessionStorage.userID}`,type:"GET",dataType:"json",beforeSend:function(){document.querySelector(".loading__icon").style.display="flex",document.querySelector("#userProfile").style.display="none"},complete:function(){document.querySelector(".loading__icon").style.display="none",document.querySelector("#userProfile").style.display="block"},success:function(e){document.querySelector("#myName").innerHTML=`${e.name} | @${e.username}`,document.querySelector("#userImage").innerHTML=`<img src="${window.name}" alt="@${e.username}'s profile picture'">`,document.querySelector("#myTitle").innerHTML=`${e.studyField} | ${e.educator}`,document.querySelector("#myDesc").innerHTML=`${e.extra}`},error:function(){alert("Error: Cannot GET")}})}):"employer"==sessionStorage.accType&&window.addEventListener("load",()=>{console.log("employer call goinggg"),$.ajax({url:`${c}/getEmployer/${sessionStorage.userID}`,type:"GET",dataType:"json",beforeSend:function(){document.querySelector(".loading__icon").style.display="flex",document.querySelector("#userProfile").style.display="none"},complete:function(){document.querySelector(".loading__icon").style.display="none",document.querySelector("#userProfile").style.display="block"},success:function(e){document.querySelector("#myName").innerHTML=`${e.name} | @${e.username}`,document.querySelector("#userImage").innerHTML=`<img src="${window.name}" alt="@${e.username}'s profile picture'">`,document.querySelector("#myTitle").innerHTML=`${e.workField} | ${e.companyName}`,document.querySelector("#myDesc").innerHTML=`${e.extra}`},error:function(){alert("Error: Cannot GET")}})})),changeDashLink=e=>{document.querySelector("#dashLink")&&(document.querySelector("#dashLink").href=e)},"student"==sessionStorage.accType?changeDashLink("studentDash.html"):"employer"===sessionStorage.accType&&changeDashLink("employerDash.html"),0!=sessionStorage.length&&document.querySelector("#loggedInNav")?(document.querySelector("#loggedInNav").style.display="block",document.querySelector("#homeNav").style.display="none"):0==sessionStorage.length&&document.querySelector("#loggedInNav")&&(document.querySelector("#loggedInNav").style.display="none",document.querySelector("#homeNav").style.display="flex"),0!=sessionStorage.length&&document.querySelector("#icon")&&(document.querySelector("#icon").innerHTML=`<img src="${window.name}" alt="@${sessionStorage.userName}'s icon'">`),document.querySelector(".nav__popover")&&(t=!1,o=document.querySelector("#icon img"),s=document.querySelector(".nav__popover"),o.addEventListener("click",()=>{t=t?!(s.style.display="none"):(s.style.display="block",!0)},!1),window.addEventListener("click",e=>{e.target!=o&&(s.style.display="none",t=!1)},!1)),"student-profiles-page"===$("body").data("title")&&($(".student-carousel").slick({arrows:!0,infinite:!0,slidesToShow:3,slidesToScroll:1,prevArrow:'<div class="slick-prev"></div>',nextArrow:'<div class="slick-next"></div>'}),window.addEventListener("load",()=>{$.ajax({url:`${c}/allStudents`,type:"GET",dataType:"json",beforeSend:function(){document.querySelector(".loading__icon").style.display="flex"},complete:function(){document.querySelector(".loading__icon").style.display="none"},success:function(e){for(var t=0;t<e.length;t++)$(".student-carousel").slick("slickAdd",`
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">${e[t].name}</h5>
                <h6>@${e[t].username} • ${e[t].educator}</h6>
                <div class="img-container__crop-students mx-auto">
                    <img src="${e[t].pfpUrl}" alt="${e[t].name}'s profile picture'">
                </div>
                <h5>${e[t].studyField}</h5>
                <p class="card-text">${e[t].extra}</p>
             </div>
            </div>
            `)},error:function(){alert("Error: Cannot GET")}})}))}();