/*! frontend 2021-09-19 */

console.log("script is linked"),console.log(sessionStorage),$(document).ready(function(){$("#createListing").hide(),$("#jobPost").hide(),$("#createAd").click(function(){$("#createListing").show()});let r;$.ajax({url:"config.json",type:"GET",dataType:"json",success:function(e){console.log(e.SERVER_URL,e.SERVER_PORT),r=`${e.SERVER_URL}:${e.SERVER_PORT}`,console.log(r)},error:function(e){console.log(e)}}),$("#addPost").click(function(){$("#jobPost").show(),$("#createListing").hide(),event.preventDefault();var e=$("#businessName").val(),t=$("#jobTitle").val(),o=$("#jobDescription").val(),a=sessionStorage.getItem("userID");console.log(a),console.log(e,t,o),""==e||""==t||""==o?alert("Please enter all details"):($.ajax({url:`${r}/addPost`,type:"POST",data:{jobTitle:t,posterName:e,jobDescription:o,username:a},success:function(e){console.log("post added")},error:function(){console.log("error: cannot call api")}}),$.ajax({url:`${r}/allPosts`,type:"GET",dataType:"json",success:function(t){var o;console.log(t);document.getElementById("editPost");for(document.getElementById("jobPost").innerHTML="",o=0;o<t.length;o++){console.log(t[o]);let e=[];if(null!==t[o].comments){var a=t[o].comments;for(x=1;x<a.length;x++)e+=`<li>${a[x]}</li>`}document.getElementById("jobPost").innerHTML+=`
            <div>
              <h2>${t[o].jobTitle}</h2>
              <h4>${t[o].posterName}</h4>
              <hr>
              <p id="postDetails">${t[o].jobDescription}</p>
            <div>
            <div>
              <button id="editPost" data-edit-id="${t[o]._id}" name="productButton" type="submit" class="btn btn-primary mx-2 edit-button">Edit</button>
              <br>
              <br>
              <button id="deletePost" data-delete-id="${t[o]._id}" name="productButton" type="submit" class="btn btn-primary mx-2 delete-button">Delete</button>
            </div>

            <p class="commentBox" data-id="${t[o]._id}">
            ${e}
            //comments go here
            </p>
            <br><b>Post comment</b>
            <input type="text" class="form-control" name="comment" placeholder="Leave a comment here" data-id="${t[o]._id}">
            <button type="button" name="button" class="btn btn-primary btn-md mr-3 rounded-pill commented" data-id="${t[o]._id}">Comment</button>
            `}},error:function(){}}))}),$(document).on("click",".commented",function(e){e.preventDefault();let t=this.dataset.id;console.log(t),console.log("comment clicked");e=$("input[data-id='"+t+"']").val();console.log(e),""==e?alert("Please enter a comment"):(console.log("Comment added: "+e),$.ajax({url:`${r}/postComment/${t}`,type:"PATCH",data:{comment:e},success:function(e){"401 error: user has no permission to update"==e?alert("401 error: user has no permission to"):alert("updated"),$("input[data-id='"+t+"']").val("")},error:function(){console.log("error:cannot call api")}}))}),$(document).on("click",".edit-button",function(e){e.preventDefault(),console.log("edit clicked");var t=$(this).attr("data-edit-id");console.log(t);var o=$("#jobDescription-test").val(),e=sessionStorage.getItem("userID");console.log(o,e),""==o?alert("Please enter post update information"):$.ajax({url:`${r}/updatePost/${t}`,type:"PATCH",data:{jobDescription:o,user_id:e},success:function(e){console.log(e),"401 error: user has no permission to update"==e?alert("401 error: user has no permission to update"):alert("updated"),$("#postDetails").val(""),$("#jobDescription-test").val("")},error:function(){console.log("error:cannot call api")}})}),studentDash=()=>{console.log(r),$.ajax({url:`${r}/allPosts`,type:"GET",dataType:"json",success:function(e){var t;for(console.log(e),document.getElementById("sdJobPost").innerHTML="",t=0;t<e.length;t++)console.log(e[t]),document.getElementById("sdJobPost").innerHTML+=`
              <h2>${e[t].jobTitle}</h2>
              <h4>${e[t].posterName}</h4>
              <hr>
              <p id="postDetails">${e[t].jobDescription}</p>
              <button id="commentOn" name="commentButton" type="submit" class="btn btn-primary mx-2">Comment</button>
              `},error:function(){}})},studentProf=()=>{console.log(r),$.ajax({url:`${r}/allPosts`,type:"GET",dataType:"json",success:function(e){var t;for(console.log(e),document.getElementById("sdJobPost").innerHTML="",t=0;t<e.length;t++)console.log(e[t]),document.getElementById("sdJobPost").innerHTML+=`
              <h2>${e[t].jobTitle}</h2>
              <h4>${e[t].posterName}</h4>
              <hr>
              <p id="postDetails">${e[t].jobDescription}</p>
              <button id="commentOn" name="commentButton" type="submit" class="btn btn-primary mx-2">Comment</button>
              `},error:function(){}})},$(document).on("click",".delete-button",function(e){e.preventDefault();e=$(this).attr("data-delete-id");console.log(e),console.log("delete clicked"),$.ajax({url:`${r}/deletePost/${e}`,type:"DELETE",data:{user_id:sessionStorage.userID},success:function(e){console.log(e),"Post Deleted"==e?alert("Post Deleted"):alert("Enter a valid id")},error:function(){console.log("error: cannot call api")}})}),$("#sRegSubmit").click(function(){event.preventDefault();var e=$("#name").val(),t=$("#username").val(),o=$("#user-email").val(),a=$("#password").val(),n=$("#StudyName").val(),l=$("#educatorName").val(),s=$("#studentExtra").val();console.log(e,t,o,a,n,l,s),""==e||""==t||""==o||""==a||""==n||""==l?alert("Please enter all student details"):$.ajax({url:`${r}/registerStudent`,type:"POST",data:{name:e,username:t,email:o,password:a,studyField:n,educator:l,extra:s},success:function(e){console.log(e),"username taken already. Please try another name"!==e?alert("Please login to manipulate the products data"):(alert("username taken already. Please try another name"),$("#username").val(""),$("#user-email").val(""),$("#password").val(""))},error:function(){console.log("error: cannot call api")}})}),$("#regSubmit").click(function(){event.preventDefault();var e=$("#name").val(),t=$("#username").val(),o=$("#user-email").val(),a=$("#password").val(),n=$("#r-name").val(),l=$("#company-name").val(),s=$("#r-extra").val();console.log(e,t,o,a,n,l,s),""==e||""==t||""==o||""==a||""==n||""==l?alert("Please enter all emplyoyer details"):$.ajax({url:`${r}/registerEmployer`,type:"POST",data:{name:e,username:t,email:o,password:a,workField:n,companyName:l,extra:s},success:function(e){console.log(e),"username taken already. Please try another name"!==e?console.log("Please login to manipulate the products data"):(console.log("username taken already. Please try another name"),$("#username").val(""),$("#user-email").val(""),$("#password").val(""))},error:function(){console.log("error: cannot call api")}})}),$("#").click(function(){event.preventDefault();var e=sessionStorage.getItem("userID");$("#name").val(),$("#username").val(),$("#user-email").val(),$("#password").val(),$("#r-name").val(),$("#company-name").val(),$("#r-extra").val();console.log(name,studyField,educator,extra,e),""==name||""==studyField||""==educator||""==extra?alert("Please enter profile update information"):$.ajax({url:`${r}/updateStudent/:id`,type:"PATCH",data:{name:name,studyField:studyField,educator:educator,extra:extra,username_id:e},success:function(e){console.log(e),"401 error: user has no permission to update"==e?alert("401 error: user has no permission to update"):alert("updated"),$("#inputidUpdate").val(""),$("#inputidUpdate").val(""),$("#inputidUpdate").val(""),$("#inputidUpdate").val("")},error:function(){console.log("error:cannot call api")}})})});