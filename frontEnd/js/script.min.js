/*! frontend 2021-09-24 */

!function(){let m;var t,a,s,d={url:""};$.ajax({url:"config.json",type:"GET",dataType:"json",success:function(e){m=`${e.SERVER_URL}:${e.SERVER_PORT}`},error:function(e){alert(e)}}),$("#createListing").hide(),$("#jobPost").hide(),$("#emjobPost").hide(),document.querySelector("#emjobPostSec")&&window.addEventListener("load",()=>{setTimeout(function(){$.ajax({url:`${m}/allPosts`,type:"GET",dataType:"json",success:function(t){var a;document.getElementById("editPost");for(document.getElementById("emjobPostSec").innerHTML="",a=0;a<t.length;a++){let e=[];if(null!==t[a].comments){var s=t[a].comments;for(x=1;x<s.length;x++)e+=`<li>${s[x]}</li>`}document.getElementById("emjobPostSec").innerHTML+=`
                <div>
                  <div id="emjobPost" class="text-light mt-4 py-4 px-4">
                    <div class="text-light mt-4 py-4 px-4">
                    <h2 id="postTitle">${t[a].jobTitle}</h2>
                    <h4 id="posterName">${t[a].posterName}</h4>
                    <hr>
                    <p id="postDetails">${t[a].jobDescription}</p>
                  <div>

                  <div>

                    <span id="editPostBtn" data-edit-id="${t[a]._id}" class="material-icons-outlined edit-button">edit</span>
                    <span id="deletePostBtn" data-delete-id="${t[a]._id}" class="material-icons-outlined delete-button">delete</span>
                    <span id="commentPostBtn" class="md-icon material-icons-outlined icon__comment comment-button">comment</span>

                    <span id="titleUpdate">${t[a].jobTitle}</span>
                    <span id="detailsUpdate">${t[a].jobDescription}
                    </span>

                  </div>

                  <div id="commentSection">
                  <span class="span__open-comments" style="display:none;">false</span>
                  <p class="commentBox" data-id="${t[a]._id}">${e}</p>
                    <br><b>Post comment</b><br><br>
                    <input type="text" class="form-control rounded-pill input__comment" name="comment" placeholder="Leave a comment here" data-id="${t[a]._id}">
                    <button type="button" name="button" class="btn btn-primary btn-md mr-3 rounded-pill commented" data-id="${t[a]._id}">Comment</button>
                  </div>

                </div>
                `}},error:function(){alert("Error: Cannot connect to API")}})},500)}),$("#createAd").click(function(){$("#createPostModal").modal("show"),$(".update-modal__update-btn--create").click(function(){event.preventDefault();var e=`${sessionStorage.userFullName} | <span class="link__email">@${sessionStorage.username}</span>`,t=$("#createTitle").val()+` | ${sessionStorage.userCompany}`,a=$("#createDesc").val(),s=sessionStorage.getItem("userID");e&&t&&""!=a?$.ajax({url:`${m}/addPost`,type:"POST",data:{jobTitle:t,posterName:e,jobDescription:a,username:s},success:function(e){alert("Your ad has been posted!"),location.reload()},error:function(){alert("Error: Cannot connect to API")}}):alert("Please enter all details to post a job ad, thank you!")})}),$(".update-modal__cancel-btn--create").click(function(){$("#createPostModal").hide(),location.reload()}),document.querySelector("#emjobPostSec")&&window.addEventListener("click",e=>{"comment"==e.target.innerText&&"false"==e.target.parentNode.parentNode.childNodes[3].children[0].innerHTML?(e.target.parentNode.parentNode.childNodes[3].style.display="block",e.target.parentNode.parentNode.childNodes[3].children[0].innerHTML="true"):"comment"==e.target.innerText&&"true"==e.target.parentNode.parentNode.childNodes[3].children[0].innerHTML&&(e.target.parentNode.parentNode.childNodes[3].style.display="none",e.target.parentNode.parentNode.childNodes[3].children[0].innerHTML="false")},!1),$(document).on("click",".commented",function(e){e.preventDefault();let t=this.dataset.id;e=`<hr><p style="font-size:20px;">${sessionStorage.userFullName} | <span class="link__email">@${sessionStorage.username}</span></p>`+$("input[data-id='"+t+"']").val();e?$.ajax({url:`${m}/postComment/${t}`,type:"PATCH",data:{comment:e},success:function(e){"401 error: user has no permission to update"==e&&alert("401 error: user has no permission to"),$("input[data-id='"+t+"']").val(""),location.reload()},error:function(){alert("error:cannot call api")}}):alert("Please enter a comment")}),window.addEventListener("click",e=>{"edit"===e.target.innerHTML&&($("#updateTitle").val(e.target.parentNode.children[3].innerText.split("|")[0]),$("#updateDesc").val(e.target.parentNode.children[4].innerText)),$(document).on("click",".edit-button",function(o){var n=$(this).attr("data-edit-id");$("#updatePostModal").modal("show"),$(".update-modal__update-btn--post").click(function(){o.preventDefault();var e=sessionStorage.getItem("userID"),t=$("#updateTitle").val()+` | ${sessionStorage.companyName}`,a=$("#updateDesc").val(),s=`${sessionStorage.userFullName} | <span class="link__email">@${sessionStorage.username}</span>`;$.ajax({url:`${m}/updatePost/${n}`,type:"PATCH",data:{jobTitle:t,jobDescription:a,posterName:s,user_id:e},success:function(e){"401 error: user has no permission to update"==e?alert("401 error: user has no permission to update"):alert("Your post has been updated."),location.reload()},error:function(){alert("Error: Cannot connect to API")}})})})},!1),$(".update-modal__cancel-btn--post").click(function(){$("#updatePostModal").hide(),location.reload()}),document.querySelector("#studentJobPosts")&&window.addEventListener("load",()=>{setTimeout(function(){$.ajax({url:`${m}/allPosts`,type:"GET",dataType:"json",success:function(t){var a;for(document.getElementById("studentJobPosts").innerHTML="",a=0;a<t.length;a++){let e=[];if(null!==t[a].comments){var s=t[a].comments;for(x=1;x<s.length;x++)e+=`<li>${s[x]}</li>`}document.getElementById("studentJobPosts").innerHTML+=`
                <div id="sdjobPost" class="text-light mt-4 py-4 px-4">
                  <div class="post__content">
                    <h2>${t[a].jobTitle}</h2>
                    <h4>${t[a].posterName}</h4>
                    <span class="md-icon material-icons-outlined icon__bookmark--blank bookmark-button">
                      bookmark_border
                    </span>
                    <hr>
                    <p id="postDetails">${t[a].jobDescription}</p>
                    <span data-id="${t[a]._id}" class="md-icon material-icons-outlined icon__comment comment-button sd-comments">
                      comment
                    </span>

                    <div id="sdCommentSection" style="display:none;">
                    <span class="span__open-comments" style="display:none;">false</span>
                      <ul class="commentBox" data-id="${t[a]._id}"> ${e} </ul>
                      <br><b>Post comment</b><br><br>
                      <input type="text" class="form-control rounded-pill input__comment" name="comment" placeholder="Leave a comment here" data-id="${t[a]._id}">
                      <button type="button" name="button" class="btn btn-primary btn-md mr-3 rounded-pill commented sd-comment-btn" data-id="${t[a]._id}">Comment</button>
                    </div>

                    </div>

                  </div>
                </div>
                `}},error:function(){alert("Error: Cannot call API")}})},500)}),document.querySelector("#studentJobPosts")&&(window.addEventListener("click",e=>{"comment"==e.target.innerText&&"false"==e.target.parentNode.children[6].children[0].innerHTML?(e.target.parentNode.children[6].style.display="block",e.target.parentNode.children[6].children[0].innerHTML="true"):"comment"==e.target.innerText&&"true"==e.target.parentNode.children[6].children[0].innerHTML&&(e.target.parentNode.children[6].style.display="none",e.target.parentNode.children[6].children[0].innerHTML="false")},!1),$(document).on("click",".sd-comment-btn",function(e){e.preventDefault();let t=this.dataset.id;e=`<hr><p style="font-size:20px;">${sessionStorage.userFullName} | <span class="link__email">@${sessionStorage.username}</span></p>`+$("input[data-id='"+t+"']").val();e?$.ajax({url:`${m}/postComment/${t}`,type:"PATCH",data:{comment:e},success:function(e){"401 error: user has no permission to update"==e&&alert("401 error: user has no permission to"),$("input[data-id='"+t+"']").val(""),location.reload()},error:function(){alert("Error: Cannot call API")}}):alert("Please enter a comment")})),$(document).on("click",".delete-button",function(e){e.preventDefault();e=$(this).attr("data-delete-id");$.ajax({url:`${m}/deletePost/${e}`,type:"DELETE",data:{user_id:sessionStorage.userID},success:function(e){"Post Deleted"==e?(alert("Post Deleted"),location.reload()):alert("Invalid Post: Post may not exist")},error:function(){alert("Error: Cannot call API")}})}),convertImg=()=>{var e,t;document.querySelector("#userIcon").files&&document.querySelector("#userIcon").files[0]&&(e=new FileReader,t=document.querySelector("#userIcon").files[0],e.readAsDataURL(t),e.addEventListener("load",e=>{d.url=e.target.result}))},document.querySelector("#userIcon")&&document.querySelector("#userIcon").addEventListener("change",convertImg),$("#studentRegSubmit").click(function(){event.preventDefault();var e=$("#sName").val(),t=$("#sUsername").val(),a=$("#sEmail").val(),s=$("#sPassword").val(),o=$("#sCheckPassword").val(),n=d.url,r=$("#studyField").val(),l=$("#educatorName").val(),i=$("#sExtra").val();s!=o?($("#sCheckPassword").val(""),alert("Passwords do not match. Please try again")):""==e||""==t||""==a||""==s||""==o||""==r||""==l||""==i?alert("Please enter all student details"):n?1e7<document.querySelector("#userIcon").files[0].size?alert("Uploaded image file size is too large. Please select an image 10mbs or less."):$.ajax({url:`${m}/registerStudent`,type:"POST",data:{name:e,username:t,email:a,password:s,pfpUrl:n,studyField:r,educator:l,extra:i},success:function(e){window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("accType","student"),"username taken already. Please try another name"!==e?(alert("You have been registered!"),window.location.href="studentDash.html"):(alert("Username taken already. Please try another name"),$("#sUsername").val(""),$("#sPassword").val(""))},error:function(){alert("Error: Cannot call API")}}):alert("Please upload an icon for the best experience on this website.")}),$("#employerRegSubmit").click(function(){event.preventDefault();var e=$("#eName").val(),t=$("#eUsername").val(),a=$("#eEmail").val(),s=$("#ePassword").val(),o=$("#eCheckPassword").val(),n=d.url,r=$("#jobTitle").val(),l=$("#companyName").val(),i=$("#eExtra").val();s!=o?($("#eCheckPassword").val(""),alert("Passwords do not match. Please try again")):""==e||""==t||""==a||""==s||""==o||""==r||""==l||""==i?alert("Please enter all employer details"):n?1e7<document.querySelector("#userIcon").files[0].size?alert("Uploaded image file size is too large. Please select an image 10mbs or less."):$.ajax({url:`${m}/registerEmployer`,type:"POST",data:{name:e,username:t,email:a,password:s,pfpUrl:n,workField:r,companyName:l,extra:i},success:function(e){window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("userCompany",e.companyName),sessionStorage.setItem("accType","employer"),"username taken already. Please try another name"!==e?(alert("You have been registered!"),window.location.href="employerDash.html"):(alert("Username taken already. Please try another name"),$("#eUsername").val(""),$("#ePassword").val(""))},error:function(){alert("Error: cannot call API")}}):alert("Please upload an icon for the best experience on this website.")}),document.querySelector("#loginSubmit")&&(document.querySelector("#loginSubmit").addEventListener("click",()=>{event.preventDefault();var e=$("#loginForm").val(),t=$("#passwordForm").val();""===e||""===t?alert("Please enter all of your details."):$.ajax({url:`${m}/loginStudent`,type:"POST",data:{username:e,password:t},success:function(e){"User not found. Please register"==e?checkEmployer():"Not authorized"==e?(alert("Please try again with correct details."),$("#loginForm").val(""),$("#passwordForm").val("")):(localStorage.clear(),window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("accType","student"),window.location.href="studentDash.html")}})},!1),checkEmployer=()=>{event.preventDefault();var e=$("#loginForm").val(),t=$("#passwordForm").val();""===e||""===t?alert("Please enter all of your details."):$.ajax({url:`${m}/loginEmployer`,type:"POST",data:{username:e,password:t},success:function(e){"User not found. Please register"==e?alert("User not found: Please register as a new user or enter the correct details."):"Not authorized"==e?(alert("Please try again with correct details."),$("#loginForm").val(""),$("#passwordForm").val("")):(window.name=e.pfpUrl,sessionStorage.setItem("userID",e._id),sessionStorage.setItem("userFullName",e.name),sessionStorage.setItem("username",e.username),sessionStorage.setItem("userEmail",e.email),sessionStorage.setItem("userPass",e.password),sessionStorage.setItem("userCompany",e.companyName),sessionStorage.setItem("accType","employer"),window.location.href="employerDash.html")}})}),document.querySelector("#logoutSubmit")&&document.querySelector("#logoutSubmit").addEventListener("click",()=>{logOut()},!1),document.querySelector("#logOut")&&document.querySelector("#logOut").addEventListener("click",()=>{logOut()},!1),logOut=()=>{sessionStorage.clear(),window.name="",alert("You have been logged out."),window.location.href="index.html"},document.querySelector("#userProfile")&&("student"==sessionStorage.accType?window.addEventListener("load",()=>{$.ajax({url:`${m}/getStudent/${sessionStorage.userID}`,type:"GET",dataType:"json",beforeSend:function(){document.querySelector(".loading__icon").style.display="flex",document.querySelector("#userProfile").style.display="none"},complete:function(){document.querySelector(".loading__icon").style.display="none",document.querySelector("#userProfile").style.display="block"},success:function(e){document.querySelector("#myName").innerHTML=`${e.name} | @${e.username}`,document.querySelector("#userImage").innerHTML=`<img src="${window.name}" alt="@${e.username}'s profile picture'">`,document.querySelector("#myTitle").innerHTML=`${e.studyField} | ${e.educator}`,document.querySelector("#myDesc").innerHTML=`${e.extra}
            <br><br>
            Contact me here: <span class="link__email">${e.email}</span>`,document.querySelector(".label__update-place").innerHTML="Educator",$("#updateName").val(`${e.name}`),$("#updateUsername").val(`${e.username}`),$("#updateEmail").val(`${e.email}`),$("#updateField").val(`${e.studyField}`),$("#updatePlace").val(`${e.educator}`),$("#updateExtra").val(`${e.extra}`)},error:function(){alert("Error: Cannot GET")}})}):"employer"==sessionStorage.accType&&window.addEventListener("load",()=>{$.ajax({url:`${m}/getEmployer/${sessionStorage.userID}`,type:"GET",dataType:"json",beforeSend:function(){document.querySelector(".loading__icon").style.display="flex",document.querySelector("#userProfile").style.display="none"},complete:function(){document.querySelector(".loading__icon").style.display="none",document.querySelector("#userProfile").style.display="block"},success:function(e){document.querySelector("#myName").innerHTML=`${e.name} | @${e.username}`,document.querySelector("#userImage").innerHTML=`<img src="${window.name}" alt="@${e.username}'s profile picture'">`,document.querySelector("#myTitle").innerHTML=`${e.workField} | ${e.companyName}`,document.querySelector("#myDesc").innerHTML=`${e.extra}
            <br><br>
            Contact me here: <span class="link__email">${e.email}</span>`,document.querySelector(".label__update-place").innerHTML="Company Name",$("#updateName").val(`${e.name}`),$("#updateUsername").val(`${e.username}`),$("#updateEmail").val(`${e.email}`),$("#updateField").val(`${e.workField}`),$("#updatePlace").val(`${e.companyName}`),$("#updateExtra").val(`${e.extra}`)},error:function(){alert("Error: Cannot GET")}})})),document.querySelector(".icon__edit")&&(document.querySelector(".icon__edit").addEventListener("click",()=>{console.log("normal modal haha"),$("#updateUserModal").modal("show")},!1),document.querySelector(".update-modal__update-btn--user").addEventListener("click",()=>{if("student"==sessionStorage.accType){event.preventDefault();var n={newPass:""},e=sessionStorage.getItem("userID");let t=$("#updateName").val(),a=$("#updateUsername").val(),s=$("#updateEmail").val();var r=$("#updatePass").val(),l=$("#checkUpdatePass").val(),i=$("#updateField").val(),d=$("#updatePlace").val(),c=$("#updateExtra").val();let o=window.name;""==r?n.newPass=sessionStorage.userPass:r&&""==l?alert("Please re-enter your new password"):r!=l?($("#checkUpdatePass").val(""),alert("Passwords do not match. Please try again")):r&&(n.newPass=r),document.querySelector("#userIcon").addEventListener("change",()=>{1e7<document.querySelector("#userIcon").files[0].size&&alert("Uploaded image file size is too large. Please select an image 10mbs or less.")}),""==t||""==a||""==s||""==i||""==d||""==c?alert("Please enter all update details"):o?$.ajax({url:`${m}/updateStudent/${e}`,type:"PATCH",data:{name:t,username:a,email:s,password:n.newPass,pfpUrl:o,studyField:i,educator:d,extra:c},success:function(e){"Error: Student profile not found"==e?alert("Error: Student profile not found"):(alert("Successfully updated your details."),$("#updatePass").val(""),$("#checkUpdatePass").val(""),window.name=o,sessionStorage.setItem("userFullName",t),sessionStorage.setItem("username",a),sessionStorage.setItem("userEmail",s),sessionStorage.setItem("userPass",n.newPass),$("#updateUserModal").modal("hide"))},error:function(){alert("Error: Can't call API")}}):alert("Please upload an icon for the best experience on this website.")}else if("employer"==sessionStorage.accType){event.preventDefault();var u={newPass:""},l=sessionStorage.getItem("userID");let t=$("#updateName").val(),a=$("#updateUsername").val(),s=$("#updateEmail").val();r=$("#updatePass").val(),e=$("#checkUpdatePass").val(),i=$("#updateField").val(),d=$("#updatePlace").val(),c=$("#updateExtra").val();let o=window.name;document.querySelector("#userIcon").addEventListener("change",()=>{1e7<document.querySelector("#userIcon").files[0].size&&alert("Uploaded image file size is too large. Please select an image 10mbs or less.")}),""==r?u.newPass=sessionStorage.userPass:r&&""==e?alert("Please re-enter your new password"):r!=e?($("#checkUpdatePass").val(""),alert("Passwords do not match. Please try again")):r&&(u.newPass=r),""==t||""==a||""==s||""==i||""==d||""==c?alert("Please enter all update details"):o?$.ajax({url:`${m}/updateEmployer/${l}`,type:"PATCH",data:{name:t,username:a,email:s,password:u.newPass,pfpUrl:o,workField:i,companyName:d,extra:c},success:function(e){"Error: Employer profile not found"==e?alert("Error: Employer profile not found"):(alert("Successfully updated your details."),$("#updatePass").val(""),$("#checkUpdatePass").val(""),sessionStorage.setItem("userFullName",t),sessionStorage.setItem("username",a),sessionStorage.setItem("userEmail",s),sessionStorage.setItem("userPass",u.newPass),window.name=o,$("#updateUserModal").modal("hide"))},error:function(){alert("Error: Can't call API")}}):alert("Please upload an icon for the best experience on this website.")}},!1),document.querySelector(".update-modal__cancel-btn").addEventListener("click",()=>{$("#updateUserModal").modal("hide")},!1)),changeDashLink=e=>{document.querySelector("#dashLink")&&(document.querySelector("#dashLink").href=e)},"student"==sessionStorage.accType?changeDashLink("studentDash.html"):"employer"===sessionStorage.accType&&changeDashLink("employerDash.html"),0!=sessionStorage.length&&document.querySelector("#loggedInNav")?(document.querySelector("#loggedInNav").style.display="block",document.querySelector("#homeNav").style.display="none"):0==sessionStorage.length&&document.querySelector("#loggedInNav")&&(document.querySelector("#loggedInNav").style.display="none",document.querySelector("#homeNav").style.display="flex"),0!=sessionStorage.length&&document.querySelector("#icon")&&(document.querySelector("#icon").innerHTML=`<img src="${window.name}" alt="@${sessionStorage.username}'s icon'">`),document.querySelector(".nav__popover")&&(t=!1,a=document.querySelector("#icon img"),s=document.querySelector(".nav__popover"),a.addEventListener("click",()=>{t=t?!(s.style.display="none"):(s.style.display="block",!0)},!1),window.addEventListener("click",e=>{e.target!=a&&(s.style.display="none",t=!1)},!1)),"student-profiles-page"===$("body").data("title")&&($(".student-carousel").slick({arrows:!0,infinite:!0,slidesToShow:3,slidesToScroll:1,prevArrow:'<div class="slick-prev"></div>',nextArrow:'<div class="slick-next"></div>'}),window.addEventListener("load",()=>{$.ajax({url:`${m}/allStudents`,type:"GET",dataType:"json",beforeSend:function(){document.querySelector(".loading__icon").style.display="flex"},complete:function(){document.querySelector(".loading__icon").style.display="none"},success:function(e){for(var t=0;t<e.length;t++)$(".student-carousel").slick("slickAdd",`
            <div class="card">
              <div class="card-body">
                <h5 class="card-title">${e[t].name}</h5>
                <h6>@${e[t].username} • ${e[t].educator}</h6>
                <div class="img-container__crop-students mx-auto">
                    <img src="${e[t].pfpUrl}" alt="${e[t].name}'s profile picture'">
                </div>
                <h5>${e[t].studyField}</h5>
                <p class="card-text">
                ${e[t].extra}
                <br><br>
                Contact: <span class="link__email">${e[t].email}</span>
                </p>
             </div>
            </div>
            `)},error:function(){alert("Error: Cannot GET")}})}))}();